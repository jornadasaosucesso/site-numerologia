<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-06417Z6ZND"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-06417Z6ZND');
    </script>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Escolha seu Arcano</title>

    <link rel="stylesheet" href="style.css" />

    <style>
        body {
            margin: 0;
            background: radial-gradient(circle at center, #000, #0a0a0a);
            color: #fff;
            font-family: 'Playfair Display', serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            cursor: default;
        }

        .tela-escolha {
        text-align: center;
        width: 100%;
        max-width: 900px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 26px;
        }

        .linha {
        display: flex;
        justify-content: center;
        gap: 16px;
        flex-wrap: nowrap;
        }

        input {
        padding: 12px 18px;
        font-size: 1.1em;
        border-radius: 10px;
        border: 1px solid rgba(212, 175, 55, 0.6);
        text-align: center;
        width: 230px;
        background: radial-gradient(circle at top, rgba(255, 240, 200, 0.05), rgba(0, 0, 0, 0.5));
        color: #fff;
        outline: none;
        box-shadow: inset 0 0 8px rgba(255, 215, 0, 0.2),
                    0 0 10px rgba(255, 215, 0, 0.1);
        transition: all 0.3s ease;
        }

        input:focus {
        border-color: #ffcc70;
        box-shadow: inset 0 0 10px rgba(255, 225, 100, 0.4),
                    0 0 18px rgba(255, 225, 100, 0.6),
                    0 0 28px rgba(255, 230, 120, 0.3);
        background: radial-gradient(circle at top, rgba(255, 255, 200, 0.08), rgba(0, 0, 0, 0.6));
        }

        input::placeholder {
        color: rgba(255, 255, 255, 0.6);
        font-style: italic;
        letter-spacing: 0.5px;
        }

        button {
        padding: 12px 36px;
        font-size: 1.2em;
        border-radius: 10px;
        background: linear-gradient(90deg, #d4af37, #ffcc70);
        color: #000;
        font-weight: bold;
        border: none;
        cursor: pointer;
        transition: transform 0.3s, box-shadow 0.3s;
        }

        button:hover {
        transform: scale(1.08);
        box-shadow: 0 0 25px #ffcc70;
        }

        video {
        width: 120px;
        height: 120px;
        object-fit: cover;
        border-radius: 12px;
        box-shadow: 0 0 18px rgba(255, 215, 0, 0.35);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        background-color: #111;
        }

        video:hover {
        transform: scale(1.1);
        box-shadow: 0 0 28px rgba(255, 230, 100, 0.8);
        filter: brightness(1.15);
        }

        @media (max-width: 600px) {
        .linha {
            flex-wrap: wrap;
        }
        input { width: 90%; }
        video { width: min(22vw, 160px); }
        }

        #feedbackMensagem {
            margin-top: 20px;
            font-weight: bold;
            font-size: 1.1em;
            min-height: 25px;
        }
    </style>
</head>

<body class="pagina-escolha">
    <main class="tela-escolha">

        <div class="linha">
            <input type="text" id="data_nascimento" placeholder="DD/MM/AAAA" maxlength="10" inputmode="numeric" required/>
            <input type="text" id="nome_individual" maxlength="60" placeholder="Seu nome" required/>
        </div>

        <div id="feedbackMensagem" style="color: #ffcc70;"></div>

        <div class="linha">
            <button id="btnCalcular">VER MEU ARCANO</button>
            <button id="btnSair">SAIR</button>
        </div>

        <div class="linha">
            <video autoplay muted loop playsinline src="imagens/arcanos/arca1.mp4"></video>
            <video autoplay muted loop playsinline src="imagens/arcanos/arca2.mp4"></video>
            <video autoplay muted loop playsinline src="imagens/arcanos/arca3.mp4"></video>
        </div>
        <div class="linha">
            <video autoplay muted loop playsinline src="imagens/arcanos/arca4.mp4"></video>
            <video autoplay muted loop playsinline src="imagens/arcanos/arca5.mp4"></video>
            <video autoplay muted loop playsinline src="imagens/arcanos/arca6.mp4"></video>
        </div>
        <div class="linha">
            <video autoplay muted loop playsinline src="imagens/arcanos/arca7.mp4"></video>
            <video autoplay muted loop playsinline src="imagens/arcanos/arca8.mp4"></video>
            <video autoplay muted loop playsinline src="imagens/arcanos/arca9.mp4"></video>
        </div>

    </main>

<script>
/* ==========================================================
   FUNÃ‡ÃƒO SHA-1 NATIVA â€” 100% FUNCIONANDO
========================================================== */
async function sha1(str) {
    const encoder = new TextEncoder();
    const data = encoder.encode(str);
    const hash = await crypto.subtle.digest("SHA-1", data);
    return Array.from(new Uint8Array(hash))
               .map(b => b.toString(16).padStart(2, "0"))
               .join("");
}

/* ==========================================================
   SISTEMA
========================================================== */
function exibirMensagem(txt, cor="#ffcc70") {
    const el = document.getElementById("feedbackMensagem");
    el.innerHTML = txt;
    el.style.color = cor;
}

document.getElementById("btnCalcular").addEventListener("click", async () => {

    let data = document.getElementById("data_nascimento").value.trim();
    let nome = document.getElementById("nome_individual").value.trim();

    if (!data || !nome) {
        exibirMensagem("Preencha todos os campos!", "#c0392b");
        return;
    }

    const dataFormatada = data.replace(/\D/g, "");
    const nomePadronizado = nome
        .toUpperCase()
        .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
        .replace(/[^A-Z\s]/g, "")
        .replace(/\s+/g, " ")
        .trim();

    const base = `${nomePadronizado}|${dataFormatada}`;
    const id_unico = await sha1(base);

    console.log("ID Ãºnico:", id_unico);
    console.log("Base:", base);

    try {
        const url = `https://site-numerologia.onrender.com/api/has_paid?id_unico=${id_unico}`;
        const res = await fetch(url);

        if (!res.ok) throw new Error("Falha ao conectar");

        const json = await res.json();

        localStorage.setItem("nome", nome);
        localStorage.setItem("data_nascimento", data);

        if (json.paid) {
            exibirMensagem("âœ… Acesso validado! Redirecionando...");
            setTimeout(() => window.location.href = "resultado.html", 800);
        } else {
            exibirMensagem("ðŸ›‘ Pagamento nÃ£o encontrado. Indo para PIX...", "#c0392b");
            setTimeout(() => {
                window.location.href =
                    `transicao.html?id_unico=${id_unico}&nome=${encodeURIComponent(nome)}&data=${encodeURIComponent(data)}`;
            }, 1500);
        }

    } catch (err) {
        exibirMensagem("âŒ Erro ao conectar ao servidor!", "#c0392b");
        console.error(err);
    }
});

document.getElementById("btnSair").addEventListener("click", () => {
    window.location.href = "index.html";
});
</script>

</body>
</html>
